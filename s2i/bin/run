#!/bin/bash -e
#
# S2I run script for the 'shepherd-drupal' image.
# The run script executes the server that runs your application.
#
# For more information see the documentation:
#      https://github.com/openshift/source-to-image/blob/master/docs/builder_image.md
#

# Make umask more permissive.
echo "---> Setting umask to 0002."
umask 0002

# Ensure /code/web directory exists, preventing Apache from crashing.
echo "---> Ensuring /code/web directory exists."
mkdir -p /code/web

echo "---> Ensuring public files directory ${PUBLIC_DIR} exists."
# If $PUBLIC_DIR is set, ensure it exists and has correct permissions.
if [ -n "${PUBLIC_DIR}" ]; then
  mkdir -p ${PUBLIC_DIR}
fi

echo "---> Ensuring private files directory ${PRIVATE_DIR} exists."
# If $PRIVATE_DIR is set, ensure it exists and has correct permissions.
if [ -n "${PRIVATE_DIR}" ]; then
  mkdir -p ${PRIVATE_DIR}
fi

echo "---> Ensuring temporary files directory ${TMP_DIR} exists."
# If $TMP_DIR is set, ensure it exists and has correct permissions.
if [ -n "${TMP_DIR}" ]; then
  mkdir -p ${TMP_DIR}
fi

echo "---> Starting s6..."
exec /init
